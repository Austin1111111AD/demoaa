import{u as O}from"./vue-i18n-2fe8389c.js";import{C as g}from"./crypto-js-629c9af4.js";import{h as m,a as U,A as P}from"./index-95894b94.js";import"./fingerprintjs2-27767ee1.js";import{u as V}from"./useMsg-ab13a7d1.js";import{a as C}from"./axios-21b846bc.js";import{c as K,r as G,e as D}from"./@vue-c5f66650.js";import{k as Q}from"./vant-5f97787a.js";const T=o=>m.get("/files/single",o),S=o=>m.get(`/filesReferences/generatePresignedUrl/${o}`),F=o=>m.post("/filesReferences",o),Z="/png/user-5a5e527a.png",N="/png/user1-2fcf4b8d.png",J="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGIAAABiCAMAAACce/Y8AAAC9FBMVEUAAAD////////////////////////y5en/////////////////8PD///////////////////////////////////////+2j8P///////////////////////+2kcL///+2kMK2kML///////////////////+2kML///////////////+5jcb6xrj7x7i2kMP////5xbj5xrm1j8K2kMK2kMK1kMK2kML///+2kML2xLf5wra1jcP///+5jcH/w7T839f4xbf6xbn84t3///8qLm22kML5xbj5xLf90b76x7m0jsL6yLoaIWexjMMnLGz1p5UrL24pLWwfJmoeJGf7zLsrLm38zr0kKmv4wrb8yrr2raY1N3EhKGr6yr32r6j2qZdRSXoyNHD4vbIaJWr8ybf1qphRVIdHQ3c3OnVAPnT9+vumqMPbt7L2tKqDhapwcp3sjoQuMm/z8vbQ0d65ksH+zr3ivLT2san4uKh+gab7s5v2rpp0ZIj39/nw8PXs7fLInr/4z73wwLn2w7jApKj2rqf2sKH5rZg9QHrb3ObX2eP95uHT1eG7vNDBmMnAnMj0zLvpurr2yLnLra24nqW1m6N4eqLwppvxoJH4nozvl4tfVIDphHtmUnk3PHgWH2UQGWK+v9K3uc2ho7/9077Spr79zLzcrrydn7zwx7nrvrnrxrjiwbaPkbLQs6/3t66Ji67mtayqkZ2mjp2aipprbplpbJnuqpflppaTgpacgZaMe5NhY5KGdI9WWYuvg4qceYajeIaedYVvX4XogHgLEl398e7fzOHQt9fHqc/60ce5ksT7wLHIqqq0mKGhiprspZSCb459bIysfYZKTYFLRIFsWn9FSH8/Q3zefnpeQ3AtJ2fy6fHx5/Dk4+3h4uvn2uro2unDxde/wNCxssmur8jhsrzYrLyZm7ufgLKef7HNr63Mq6vMqarGqKmJcaWwlaGCa6H6tZ5kaJaTepJ7bo3MjopKT4WOb4ONb4PHdHeIhDMLAAAARHRSTlMA/gj0j2ERBtuF7dIEV+rQyMSwoIB8bGQ/OCkkFPf17uvbz763tqenpolwGhPwioLc09LQyMSOfms/OiomHR0R9G5tWWZlvgsAAAf1SURBVGjerVp1fNNQEE5g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",ae=()=>{const{toastLoading:o,toastSuccess:y}=V(),{t:H}=O(),i=U(),R=K(()=>{var e,r,t;return((e=i.memberGet)==null?void 0:e.avatar)||(((r=i.memberGet)==null?void 0:r.gender)==="1"?N:((t=i.memberGet)==null?void 0:t.gender)==="2"?J:Z)}),l=G(!1),s=D({url:"",relatedKind:"1",relatedId:""}),w=2,M=K(()=>!s.url),v=e=>{const r=e;if(!(r.size/1024/1024<w)){Q({type:"warning",message:H("msg.request.FileMaxSize",[w])});return}return q(r),!1},c=e=>{s.url=e},E=e=>new Promise(r=>{const t=new FileReader;t.readAsArrayBuffer(e),t.onload=p=>{var u,d;const a=g.lib.WordArray.create((u=p.target)==null?void 0:u.result),n=g.MD5(a).toString(g.enc.Hex);r({hash:n,data:(d=p.target)==null?void 0:d.result})}}),q=async e=>{var u,d,A,L,b,h,j,f,I,x,k,z;const r=await E(e),t=e.name.substring(e.name.lastIndexOf(".")),p=r.hash+t,a=await S(p);if(!((u=a.data)!=null&&u.row)){c("");return}const n=await T({bucket:(d=a.data)==null?void 0:d.row.bucket,hash:r.hash});if((L=(A=n.data)==null?void 0:A.row)!=null&&L.url){await F({bucket:(b=a.data)==null?void 0:b.row.bucket,type:t,hash:r.hash,size:e.size,contentType:e.type,url:(h=n.data)==null?void 0:h.row.url,name:e.name,relatedKind:s.relatedKind,relatedId:s.relatedId}),c((j=n.data)==null?void 0:j.row.url);return}C.request({url:((I=(f=a==null?void 0:a.data)==null?void 0:f.row)==null?void 0:I.uploadUrl)??"",method:"PUT",data:r.data,headers:{"Content-Type":""}}),await F({bucket:(x=a.data)==null?void 0:x.row.bucket,type:t,hash:r.hash,size:e.size,contentType:e.type,url:(k=a.data)==null?void 0:k.row.url,name:e.name,relatedKind:s.relatedKind,relatedId:s.relatedId}),c(((z=a.data)==null?void 0:z.row.url)??"")};return{uploaderBind:s,isDisable:M,loading:l,memberAvatar:R,beforeRead:v,handleUpdate:()=>{l.value=!0;const e=o(),r={avatar:s.url};P(r).then(({data:t})=>{t!=null&&t.row&&(y(),i.setMember(),c(""))}).finally(()=>{l.value=!1,e.close()})}}};export{ae as u};
